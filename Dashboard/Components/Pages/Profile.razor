@page "/profile"
@using Microsoft.EntityFrameworkCore
@using Dashboard.Model
@inject NavigationManager Nav
@inject Dashboard.Connect.DashboardDbContext DB
@inject Dashboard.Services.LoginService loginService

@if (loginService?.IsLoggedIn == true)
{
    @if (user != null)
    {
        <div class="card mt-4 shadow-sm" style="max-width: 600px; margin: auto;">
            <div class="row g-0">
                <!-- Profile Image Section -->
                <div class="col-md-4 text-center p-3">
                    <img src="/imgs/cat.PNG" class="img-fluid rounded-circle" alt="Profile Image" />
                </div>
                <!-- Profile Details Section -->
                <div class="col-md-8">
                    <div class="card-body">
                        <h2 class="card-title">Profile</h2>
                        <hr />
                        <p class="card-text"><strong>Username:</strong> @user.Username</p>
                        <p class="card-text"><strong>Email:</strong> @user.Email</p>
                    </div>
                </div>
            </div>
        </div>

    }
    else
    {
        <p class="text-center">Loading profile...</p>
    }
}
else
{
    <p class="text-center">Please Login...</p>
}

@code {
    private User? user;

    protected override async Task OnInitializedAsync()
    {
        if (loginService != null && loginService.IsLoggedIn)
        {
            user = await DB.Users.FirstOrDefaultAsync(m => m.Id == loginService.Id);

            if (user is null)
            {
                Nav.NavigateTo("notfound");
            }
        }
        else
        {
            Nav.NavigateTo("/login");
        }
    }
}
