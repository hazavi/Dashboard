@page "/news"
@inject Dashboard.Services.NewsDataService NewsService

<h3>Top World News</h3>

@if (newsDataItems == null)
{
    <p>Loading...</p>
}
else if (newsDataItems.Length == 0)
{
    <p>No news items available.</p>
}
else
{
    <div class="news-container">
        @foreach (var item in newsDataItems)
        {
            <div class="news-item">
                <h4>@item.Title</h4>
                @if (!string.IsNullOrEmpty(item.ImageUrlToShow))
                {
                    <img src="@item.ImageUrlToShow" alt="News Image" class="news-image" />
                }
                else
                {
                    <p>No image available.</p>
                }
                <p>@item.Description</p>
                <a href="@item.Link" target="_blank">Read more</a>
            </div>
        }
    </div>
}

@code {
    private NewsDataItem[] newsDataItems = Array.Empty<NewsDataItem>();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await NewsService.GetTopNewsAsync();
            if (response?.Results != null && response.Results.Length > 0)
            {
                newsDataItems = response.Results;

                // Log each image URL to verify
                foreach (var item in newsDataItems)
                {
                    Console.WriteLine($"Image URL: {item.ImageUrl}");
                }
            }
            else
            {
                newsDataItems = Array.Empty<NewsDataItem>();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching news: {ex.Message}");
            newsDataItems = Array.Empty<NewsDataItem>();
        }
    }


}
